# ๐ ุฏููู ุฅุนุฏุงุฏ Cloudflare R2 - ุจุงูุนุฑุจูุฉ

## ๐ ูุธุฑุฉ ุณุฑูุนุฉ

ุชู ุฅุนุฏุงุฏ ุงูุชุทุจูู ูุงุณุชุฎุฏุงู **Cloudflare R2** ุจุฏูุงู ูู Supabase Storage ูุญูุธ:
- โ ุตูุฑ ุงูุจุฑููุงููุงุช
- โ ุตูุฑ ุฅุซุจุงุช ุงูุฅูุฏุงุน
- โ ูุณุชูุฏุงุช ุงูุฃุทุจุงุก (ุงูุดูุงุฏุงุช ูุตูุฑ ุงูุจุทุงูุฉ ุงูุดุฎุตูุฉ)

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุฃุณุงุณูุฉ (5 ุฏูุงุฆู)

### ุงูุฎุทูุฉ 1: ุฅูุดุงุก Bucket ูู Cloudflare

1. ุงุฐูุจ ุฅูู [Cloudflare Dashboard](https://dash.cloudflare.com)
2. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุถุบุท **R2** (ุฃู **Object Storage**)
3. ุฅุฐุง ูู ููู R2 ููุนู ูุฏูู:
   - ุงุถุบุท **Enable R2**
   - ูุฏ ุชุญุชุงุฌ ูุชูุนูู ุงูุฏูุน (R2 ูู ุฎุทุฉ ูุฌุงููุฉ)
4. ุงุถุบุท **Create bucket**
5. **ุฃุฏุฎู ุงุณู Bucket ุจุงูุถุจุท: `app-storage`** (ูุฐุง ููู ุฌุฏุงู!)
6. ุงุฎุชุฑ ุงููููุน (Location) - ุฃู ูููุน ููุงุณุจ
7. ุงุถุบุท **Create bucket**

### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู API Tokens

ุงูุชุทุจูู ูุณุชุฎุฏู ุงูููุงุชูุญ ุงูุชุงููุฉ (ููุฌูุฏุฉ ูู ุงูููุฏ):
- โ Account ID: `8cb0db3d90f1e157c16a59a6a5ebe212`
- โ Access Key ID: `625a91c9599cc24794da6480aa1b0c81`
- โ Secret Access Key: (ูุฎุฒู ูู ุงูููุฏ)
- โ Endpoint: `https://8cb0db3d90f1e157c16a59a6a5ebe212.r2.cloudflarestorage.com`

**ุฅุฐุง ูู ููู ูุฏูู API Token:**
1. ูู ุตูุญุฉ R2ุ ุงุถุบุท **Manage R2 API Tokens**
2. ุงุถุบุท **Create API Token**
3. ุงุฎุชุฑ:
   - **Permissions**: `Object Read & Write`
   - **Bucket**: `app-storage`
4. ุงุถุบุท **Create API Token**
5. ุงูุณุฎ ุงูููุงุชูุญ ูุงุญูุธูุง ูู ููุงู ุขูู

---

## โ ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏ

ุจุนุฏ ุฅูุดุงุก ุงูู Bucketุ ุฌุฑุจ ุงูุชุงูู:

### 1. ุฑูุน ุตูุฑุฉ ุจุฑููุงูู
```
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุจุฑููุงูู
3. ุงุถุบุท ุนูู ุตูุฑุฉ ุงูุจุฑููุงูู
4. ุงุฎุชุฑ ุตูุฑุฉ (ุญุฌู ุฃูู ูู 5MB)
5. ูุฌุจ ุฃู ุชุธูุฑ ุฑุณุงูุฉ "ุชู ุจูุฌุงุญ!"
```

### 2. ุฑูุน ุฅุซุจุงุช ุฅูุฏุงุน
```
1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุฅูุฏุงุน
2. ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน
3. ุงุฑูุน ุตูุฑุฉ ุฅุซุจุงุช ุงูุฅูุฏุงุน
4. ูุฌุจ ุฃู ูุนูู ุจูุฌุงุญ
```

### 3. ุนุฑุถ ุงูุตูุฑ ูู ููุญุฉ ุงููุดุฑู
```
1. ุณุฌู ุฏุฎูู ููุดุฑู
2. ุงุฐูุจ ุฅูู ููุญุฉ ุงููุดุฑู
3. ุงุถุบุท ุนูู "ุนุฑุถ ุฅุซุจุงุช ุงูุฏูุน"
4. ูุฌุจ ุฃู ุชุธูุฑ ุงูุตูุฑุฉ ุจุดูู ุตุญูุญ
```

---

## ๐ง ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ (ุงุฎุชูุงุฑู)

### ุฌุนู ุตูุฑ ุงูุจุฑููุงูู ุนุงูุฉ (Public)

1. ุงุฐูุจ ุฅูู R2 โ **app-storage** โ **Settings**
2. ูู ูุณู **Public Access**ุ ุงุถุบุท **Allow Access**
3. ุณุชุญุตู ุนูู ุฑุงุจุท ูุซู: `https://pub-xxxxx.r2.dev`
4. ููููู ุงุณุชุฎุฏุงู ูุฐุง ุงูุฑุงุจุท ูู `getR2PublicUrl()` ููุฃุฏุงุก ุงูุฃูุถู

**ููุงุญุธุฉ:** ุฅุซุจุงุชุงุช ุงูุฅูุฏุงุน ุชุจูู ุฎุงุตุฉ ุจุงุณุชุฎุฏุงู Signed URLs

### ุฑุจุท ูุทุงู ูุฎุตุต (Custom Domain)

1. ูู ุฅุนุฏุงุฏุงุช ุงูู Bucket โ **Settings** โ **Custom Domains**
2. ุงุถุบุท **Connect Domain**
3. ุฃุฏุฎู subdomain ูุซู: `cdn.egyptianai.app`
4. ุงุชุจุน ุงูุชุนูููุงุช ูุฅุนุฏุงุฏ DNS ูู Cloudflare
5. ุจุนุฏ ุงูุฅุนุฏุงุฏุ ููููู ุงุณุชุฎุฏุงู `getR2PublicUrl(path, 'https://cdn.egyptianai.app')`

---

## ๐ ูููู ุงููููุงุช ูู R2

```
app-storage/
โโโ profile-images/          โ ุตูุฑ ุงูุจุฑููุงูู
โ   โโโ {user-id}/
โ       โโโ {timestamp}.jpg
โ
โโโ deposit-proofs/         โ ุตูุฑ ุฅุซุจุงุช ุงูุฅูุฏุงุน
โ   โโโ {user-id}/
โ       โโโ {timestamp}.jpg
โ
โโโ doctor-documents/        โ ูุณุชูุฏุงุช ุงูุฃุทุจุงุก
    โโโ {user-id}/
        โโโ certificates/
        โโโ id-cards/
        โโโ ...
```

---

## โ ุญู ุงููุดุงูู

### ูุดููุฉ: "Failed to upload file"
โ **ุงูุญู:**
1. ุชุญูู ูู ุงุณู ุงูู Bucket: ูุฌุจ ุฃู ูููู `app-storage` ุจุงูุถุจุท
2. ุชุญูู ูู ุตูุงุญูุงุช ุงูู API Token (ูุฌุจ ุฃู ุชููู Read & Write)
3. ุชุญูู ูู ุฃู ุงูููุงุชูุญ ูู `src/lib/r2-storage.ts` ุตุญูุญุฉ

### ูุดููุฉ: ุงูุตูุฑ ูุง ุชุธูุฑ
โ **ุงูุญู:**
1. ุงูุชุญ Console ูู ุงููุชุตูุญ (F12)
2. ุงุจุญุซ ุนู ุฃุฎุทุงุก R2
3. ุชุญูู ูู ุฃู ุงููุณุงุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุตุญูุญ
4. ุชุฃูุฏ ูู ุฃู Signed URL ูุชู ุฅูุดุงุคู ุจุดูู ุตุญูุญ

### ูุดููุฉ: "Bucket not found"
โ **ุงูุญู:**
1. ุชุญูู ูู ุฃู Bucket ุงุณูู `app-storage` ุจุงูุถุจุท
2. ุชุฃูุฏ ูู ุฃูู ูู ุงูู Account ุงูุตุญูุญ
3. ุชุญูู ูู ุงูู Account ID

### ูุดููุฉ: "Access Denied"
โ **ุงูุญู:**
1. ุชุญูู ูู ุตูุงุญูุงุช ุงูู API Token
2. ุชุฃูุฏ ูู ุฃู Token ูุฑุจูุท ุจุงูู Bucket `app-storage`
3. ุชุญูู ูู ุฃู Secret Access Key ุตุญูุญ

---

## ๐ ุงูุชุญูู ูู ุฃู ูู ุดูุก ูุนูู

### โ ูุงุฆูุฉ ุงูุชุญูู:

- [ ] Bucket `app-storage` ููุฌูุฏ ูู Cloudflare R2
- [ ] API Token ูู ุตูุงุญูุงุช Read & Write ุนูู `app-storage`
- [ ] ุงูููุงุชูุญ ููุฌูุฏุฉ ูู `src/lib/r2-storage.ts`
- [ ] ูููู ุฑูุน ุตูุฑุฉ ุจุฑููุงูู ุจูุฌุงุญ
- [ ] ูููู ุฑูุน ุฅุซุจุงุช ุฅูุฏุงุน ุจูุฌุงุญ
- [ ] ุตูุฑ ุฅุซุจุงุช ุงูุฅูุฏุงุน ุชุธูุฑ ูู ููุญุฉ ุงููุดุฑู
- [ ] ูููู ุญุฐู ุงูุตูุฑ ูู ููุญุฉ ุงููุดุฑู

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดููุฉ:
1. ุฑุงุฌุน ููู `CLOUDFLARE_R2_SETUP.md` ููุชูุงุตูู ุงูุฅุถุงููุฉ
2. ุชุญูู ูู [Cloudflare R2 Docs](https://developers.cloudflare.com/r2/)
3. ุงูุญุต Console ูู ุงููุชุตูุญ ููุฃุฎุทุงุก
4. ุชุฃูุฏ ูู ุฃู ุฌููุน ุงูููุงุชูุญ ุตุญูุญุฉ

---

## ๐ ุชู ุงูุฅุนุฏุงุฏ ุจูุฌุงุญ!

ุจุนุฏ ุฅุชูุงู ุฌููุน ุงูุฎุทูุงุช ูุงูุชุญูู ูู ุฃู ูู ุดูุก ูุนููุ ุงูุชุทุจูู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูุน Cloudflare R2!

**ููุงุญุธุฉ:** ุงููููุงุช ุงููุฏููุฉ ูู Supabase Storage ุณุชุณุชูุฑ ูู ุงูุนูู ุฅุฐุง ูุงูุช URLs ูุงููุฉ. ุงููููุงุช ุงูุฌุฏูุฏุฉ ุณุชูุฑูุน ุชููุงุฆูุงู ุฅูู R2.
